<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">
	
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script> 
	<title>Sign Up</title>
	
	
	<link rel="stylesheet" type="text/css" href="./stylesheets/signup.css">
	<script>
		$(document).ready(function() {
			$('#password').keyup(function() {
				$('#result').html(checkStrength($('#password').val()))
			})
			function checkStrength(password) {
				var strength = 0
				if (password.length < 6) {
					$('#result').removeClass()
					$('#result').addClass('short')   
					return 'Too short'
				}
				if (password.length > 7) strength += 1
			// If password contains both lower and uppercase characters, increase strength value.
		if (password.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)) strength += 1
			// If it has numbers and characters, increase strength value.
		if (password.match(/([a-zA-Z])/) && password.match(/([0-9])/)) strength += 1
			// If it has one special character, increase strength value.
		if (password.match(/([!,%,&,@,#,$,^,*,?,_,~])/)) strength += 1
			// If it has two special characters, increase strength value.
		if (password.match(/(.*[!,%,&,@,#,$,^,*,?,_,~].*[!,%,&,@,#,$,^,*,?,_,~])/)) strength += 1
			// Calculated strength value, we can return messages
			// If value is less than 2
			if (strength < 2) {
				$('#result').removeClass()
				$('#result').addClass('weak')
				return 'Weak'
			} else if (strength == 2) {
				$('#result').removeClass()
				$('#result').addClass('good')
				return 'Good'
			} else {
				$('#result').removeClass()
				$('#result').addClass('strong')
				return 'Strong'
			}
		}
		});
	</script>
</head>
<body>
	<nav class="navbar navbar-inverse navbar-static-top">
		<div class="navbar-header">
				<a class="navbar-brand" href="http://localhost:3000/">Flight Tickets</a>
		</div>
		<div class="container-fluid">
			<form class="navbar-form navbar-right" method="post" action="/signin" id="signin">
				<div class="form-group">
					<input type="text" class="form-control" placeholder="username" name="emailid">
				</div>
				<div class="form-group">
					<input type="password" class="form-control" placeholder="password" name="password">
				</div>
				<button type="submit" class="btn btn-success">Sign In</button>
			</form>
		</div>
	</nav>
	
	<div class="signup-form">	
			<form id="newEntryForm">
				<h2>Create Account</h2>
				<p class="lead">It's free and hardly takes more than 30 seconds.</p>
				<div class="form-group">
					<div class="input-group">
						<span class="input-group-addon"><i class="fa fa-user"></i></span>
						<input type="text" class="form-control" id="firstname" placeholder="Firstname" required="required">
					</div>
				</div>
				<div class="form-group">
						<div class="input-group">
							<span class="input-group-addon"><i class="fa fa-user"></i></span>
							<input type="text" class="form-control" id="lastname" placeholder="Lastname" required="required">
						</div>
				</div>
				<div class="form-group">
					<div class="input-group">
						<span class="input-group-addon"><i class="fa fa-paper-plane"></i></span>
						<input type="email" class="form-control" name="emailid" id="emailid" placeholder="Email Address" required="required">
						<span id="taken"></span>
					</div>
				</div>
				<div class="form-group">
					<div class="input-group">
						<span class="input-group-addon"><i class="fa fa-lock"></i></span>
						<input type="password" class="form-control" name="password" id="password" placeholder="Password" required="required">
						<span id="result"></span>
					</div>
				</div>
				<div class="form-group">
						<div class="input-group">
							<span class="input-group-addon"><i class="fa fa-mobile"></i></span>
							<input type="number" class="form-control" name="mobile" id="mobile" placeholder="Mobile">
				</div>
				</div>
				
				<div class="form-group">
					<button type="submit" class="btn btn-primary btn-block btn-lg">Sign Up</button>
					<button type="submit" class="btn btn-default btn-block btn-lg">Clear</button>
				</div>
				<p class="small text-center">By clicking the Sign Up button, you agree to our <br><a href="#">Terms &amp; Conditions</a>, and <a href="#">Privacy Policy</a>.</p>
			</form>
			<div class="text-center">Already have an account? <a href="#">Login here</a>.</div>
		</div>
	<script type="text/javascript">
		$(function() {
			$('#newEntryForm').submit(function(event) {
				event.preventDefault();
				var formdata = {
					"firstname": $('#firstname').val(),
					"lastname": $('#lastname').val(),
					"password": $('#password').val(),
					"emailid": $('#emailid').val(),
					"mobile": $('#mobile').val(),
				};
				$.ajax({
					type: "POST",
					url: "/signup", 
					data: formdata,
					success: function(data){
						if(data === "taken"){
							$('#taken').text("This email is taken");
						}
						if(data === "done")
							window.location.replace('http://localhost:3000/public/index.html');
						else
							alert("Registration error. Please retry!");
					},
					failure: function(errMsg) {
						alert("Registration error. Please retry!");
					}
				});
			});
		});
	</script>
</body>
</html>